"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const path = require("path");
const utils_1 = require("../utils");
const webpack_umd_config_1 = require("../models/webpack-umd.config");
const webpack = require('webpack');
// todo: move to constants and make it configurable
const bundlesDir = 'bundles';
// Configure build and output;
let lastHash = null;
const webpackOutputOptions = {
    colors: true,
    chunks: true,
    modules: false,
    reasons: false,
    chunkModules: false
};
// export function bundleUmd(dir, moduleConf, minify) {
function bundleUmd({ src, dist, name, main, tsconfig, minify }) {
    const config = webpack_umd_config_1.getWebpackConfig({
        name: !minify ? `${name}.umd` : `${name}.umd.min`,
        root: path.resolve(utils_1.ROOT, src),
        entry: path.resolve(utils_1.ROOT, src, main),
        output: path.resolve(dist, bundlesDir),
        tsconfig: tsconfig
    });
    if (minify) {
        config.optimization.minimize = true;
    }
    const webpackCompiler = webpack(config);
    return new Promise((resolve, reject) => {
        webpackCompiler.run((err, stats) => {
            if (err) {
                if (stats) {
                    process.stdout.write(stats.toString(webpackOutputOptions) + '\n');
                }
                return reject(err);
            }
            if (stats.hasErrors()) {
                process.stdout.write(stats.toString(webpackOutputOptions) + '\n');
            }
            return stats.hasErrors() ? reject() : resolve();
        });
    });
}
exports.bundleUmd = bundleUmd;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVuZGxlLXVtZC50YXNrLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3Rhc2tzL2J1bmRsZS11bWQudGFzay50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLDZCQUE4QjtBQUM5QixvQ0FBZ0M7QUFDaEMscUVBQWdFO0FBQ2hFLE1BQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUVuQyxtREFBbUQ7QUFDbkQsTUFBTSxVQUFVLEdBQUcsU0FBUyxDQUFDO0FBRTdCLDhCQUE4QjtBQUM5QixJQUFJLFFBQVEsR0FBRyxJQUFJLENBQUM7QUFDcEIsTUFBTSxvQkFBb0IsR0FBRztJQUMzQixNQUFNLEVBQUUsSUFBSTtJQUNaLE1BQU0sRUFBRSxJQUFJO0lBQ1osT0FBTyxFQUFFLEtBQUs7SUFDZCxPQUFPLEVBQUUsS0FBSztJQUNkLFlBQVksRUFBRSxLQUFLO0NBQ3BCLENBQUM7QUFFRix1REFBdUQ7QUFDdkQsbUJBQTBCLEVBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUM7SUFDakUsTUFBTSxNQUFNLEdBQUcscUNBQWdCLENBQUM7UUFDOUIsSUFBSSxFQUFFLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksVUFBVTtRQUNqRCxJQUFJLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFJLEVBQUUsR0FBRyxDQUFDO1FBQzdCLEtBQUssRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLFlBQUksRUFBRSxHQUFHLEVBQUUsSUFBSSxDQUFDO1FBQ3BDLE1BQU0sRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxVQUFVLENBQUM7UUFDdEMsUUFBUSxFQUFFLFFBQVE7S0FDbkIsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUNYLE1BQU0sQ0FBQyxZQUFZLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztJQUN0QyxDQUFDO0lBRUQsTUFBTSxlQUFlLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBRXhDLE1BQU0sQ0FBQyxJQUFJLE9BQU8sQ0FBQyxDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsRUFBRTtRQUNyQyxlQUFlLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLEtBQUssRUFBRSxFQUFFO1lBQ2pDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ1IsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztvQkFDVixPQUFPLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLG9CQUFvQixDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7Z0JBQ3BFLENBQUM7Z0JBQ0QsTUFBTSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNyQixDQUFDO1lBRUQsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUMsQ0FBQztnQkFDdEIsT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxvQkFBb0IsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDO1lBQ3BFLENBQUM7WUFFRCxNQUFNLENBQUMsS0FBSyxDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDbEQsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUM7QUEvQkQsOEJBK0JDIn0=